@(uid:String)
<div type="button" class="close pull-right postkit-closebtn" style="position:absolute;margin-right:15px">&times;</div>
<div class="postkit-message" contenteditable="plaintext-only" style="max-height:200px"></div>
<div class="postkit-toolsbody">
<input type="file" name="pic" id="@{uid}_uploadify"/>
<div class="progress progress-striped active hide pull-right postkit-progressbar" style="border-radius:2px;margin-top:20px;margin-right:30px;width:200px;height: 18px">
<div class="bar" style="width: 0%;"></div>
</div>
<div class="picContainer" style="text-align:center;margin-top:20px"></div>
</div>
<script>
    tmpFiles = [];
    var picProgressBar = $('.postkit-progressbar');
    var picBtn = $('#'+'@{uid}_uploadify');
    picBtn.ready(function(){
        picBtn.uploadify({
            swf: '/assets/img/uploadify.swf',
            uploader: '/posts/uploadify',
            buttonClass: 'postkit-tool-photo',
            width: 18,
            height: 18,
            buttonText: '',
            method: 'post',
            auto: true,
            fileTypeDesc : 'Image Files',
            fileTypeExts : '*.gif; *.jpg; *.png',
            multi: false,
            overrideEvents : ['onSelect'],
            onUploadStart: function(){
                picProgressBar.show();
            },
            onUploadError: function(){
                setTimeout(picProgressBar.hide(),2000);
            },
            onUploadProgress: function(file,bytesUploaded,bytesTotal,totalBytesUploaded,totalBytesTotal){
                bar.css('width',bytesUploaded/bytesTotal*100+'%');
                bar.text((bytesTotal/1024).toFixed(2)+' KB');
            },
            onUploadSuccess : function(file, data, response){
                tmpFiles.push(data);
                var img = $('<img src="'+data+'" style="max-width:400px;"/>');
                setTimeout(function(){
                    picProgressBar.hide();
                    picContainer.append(img)
                    return false;
                },2000);
                return false;
            }
        });
    });
    var postMessage = $('.postkit-message');
    $('.postkit-closebtn').click(function(){
        if($this.tmpFiles.length > 0){
            var params = {};
            params["tmpfiles"] = $this.tmpFiles;
            $.post($this.deleteTmpFilesURL,params);
            $this.tmpFiles = [];
        }
        postMessage.empty();
        picContainer.empty();
        $this.$element.hide();
        shareBtn.addClass('disabled');
    });

</script>
