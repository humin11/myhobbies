@(courtForm: Form[Court])

@import helper._

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) } 
@styles = {
	<link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/court.css")">
}
@scripts = {
  <script src="@routes.Assets.at("javascripts/jqBootstrapValidation.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("javascripts/court.js")" type="text/javascript"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
}

@main(Messages("court.new"), null , styles, scripts) {
  <div class="span12">
    <div class="widget">
      <div class="widget-header">
        <div class="title">
          @Messages("court.new")
        </div>
        <span class="tools">
          <a class="fs1" aria-hidden="true" data-icon="&#xe090;"></a>
        </span>
      </div>
      <div class="widget-body">


        @form(action = routes.Courts.save(), 'enctype -> "multipart/form-data", 'class -> "form-horizontal no-margin") {
			@courtForm.errors.map { error =>
            	 <div class="alert alert-block alert-error fade in">
                      <button data-dismiss="alert" class="close" type="button">
                        ×
                      </button>
                      <h4 class="alert-heading">
                        Error!
                      </h4>
                      <p>
                        @error.message
                      </p>
                    </div>
            }
          
          <div class="row-fluid">
            <div class="span9">
              @inputText(courtForm("name"), 'class ->"input-block-level", '_label -> Messages("name", Messages("court")), '_help -> Messages("name.help", Messages("court")), 'placeholder -> Messages("name.help", Messages("court")), 'minlength -> "2", 'maxlength -> "128", 'required -> "required")
              @inputText(courtForm("businesshours"), 'class ->"input-block-level", '_label -> Messages("businesshours", Messages("court")), '_help -> Messages("businesshours.help", Messages("court")), 'placeholder -> Messages("businesshours.help", Messages("court")))
              @inputText(courtForm("telephone"), 'class ->"input-block-level", '_label -> Messages("telephone", Messages("court")), '_help -> Messages("telephone.help", Messages("court")), 'placeholder -> Messages("telephone.help", Messages("court")))
              @inputText(courtForm("address"), 'class ->"input-block-level", '_label -> Messages("address", Messages("court")), '_showConstraints -> false, 'placeholder -> Messages("address.help", Messages("court")), 'required -> "required")
              <div class="control-group">
				<div class="controls">
				  <div class="row-fluid">
		        	<div class="span12" id="court_location">
		            </div>
		          </div>
				  <input type="hidden" name="longitude" id="longitude" />
				  <input type="hidden" name="latitude" id="latitude" />
				</div>
			</div>
            </div>
            <div class="span3">
              <div class="thumbnail">
                <div id="prev_logo"><img src="@routes.Assets.at("images/court.default.png")" id="logo_container"/></div>
                <div class="caption">
                    <span class="btn btn-success btn-mini fileinput-button">
                    <i class="icon-plus icon-white"></i>
                    <span>@Messages("logo.new")</span>
                    <input type="file" id="logo" name="logo" multiple>
                </span>
                </div>
              </div>
              
            </div>
          </div>
          <div class="form-actions no-margin">
            <button type="submit" class="btn btn-info pull-right">
              @Messages("submit")
            </button>
            <div class="clearfix">
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
<script type="text/javascript">
	var map = new BMap.Map("court_location");
	map.addControl(new BMap.NavigationControl()); 
	// 创建地址解析器实例
	var myGeo = new BMap.Geocoder();
	var geolocation = new BMap.Geolocation();
	// 将地址解析结果显示在地图上,并调整地图视野
	geolocation.getCurrentPosition(function(r){
	    if(this.getStatus() == BMAP_STATUS_SUCCESS){
	        var mk = new BMap.Marker(r.point);
	        map.centerAndZoom(r.point, 16);
	        map.addOverlay(mk);
	    } else {
	    	myGeo.getPoint("北京市海淀区", function(point){
	    		  if (point) {
	    		    map.centerAndZoom(point, 16);
	    		    map.addOverlay(new BMap.Marker(point));
	    		  }
	    		}, "北京市");
	    }
	});
	
	var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
		    {"input" : "address"
		    ,"location" : map
		});

		var myValue;
		ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
			var _value = e.item.value;
		    myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
		    $("#address").val(myValue);
		    setPlace();
		});

		function setPlace(){
		    //map.clearOverlays();    //清除地图上所有覆盖物
		    function myFun(){
		        var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
		        map.centerAndZoom(pp, 16);
		        map.addOverlay(new BMap.Marker(pp));    //添加标注
		        $("#longitude").val(pp.lng);
		        $("#latitude").val(pp.lat);
		    }
		    var local = new BMap.LocalSearch(map, { //智能搜索
		      onSearchComplete: myFun
		    });
		    local.search(myValue);
		}
	
</script>
