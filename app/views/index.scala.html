@(message: String, posts: Seq[Post] = Nil, contacts: Seq[User] = Nil, recommendUsers: Seq[User] = Nil)

@row(list:Seq[User], num:Int = 5) = {
    <div class="row-fluid">
    @for(i <- 0 until list.size){
        @if(i>0 && i%5 == 0){
            </div>
            <div class="row-fluid">
        }
        @views.html.post.avatar(list(i).id)
    }
    </div>
}


@main("Welcome to CGLQ") {
    <script src="@routes.Assets.at("javascripts/jquery.uploadify-3.1.min.js")" type="text/javascript"></script>
    <div id="main-container" class="container">
        <div class="row-fluid">
            <a id="newBtn" class="btn pull-right"><i class="icon-pencil"></i>&nbsp;Share</a>
            <div id="postModal" class="hide"></div>
            <div id="avatarModal" class="postkit-wrapper hide"></div>
        </div>
        <div class="row-fluid" style="background-color:#FFF">
            <div class="span3">
            </div>
            <div id="post-list" class="span6">
                @for(p <- posts) {
                    @views.html.post.post(p)
                }
            </div>
            <div id="right-panel" class="span3">
                <div id="recommend-list" class="row-fluid" style="height:80px">
                    推荐的人
                    @row(recommendUsers)
                </div>
                <div id="contact-list" class="row-fluid" style="height:80px">
                    已关注的人
                    @row(contacts)
                </div>
            </div>
        </div>
    </div>
    <script>
        $('#postModal').postkit({
            id:'newPost',
            anchor:'newBtn',
            showtype: 'popup',
            afterPost: function(data){
                $('#post-list').prepend(data);
                var newPost = $('#post-list:first');
                avatarHoverHandler(newPost.find('.avatar-icon'));
                postDelBtnClickHandler(newPost.find('.post-delbtn'));
                postExpandBtnClickHandler(newPost.find('.post-message-min'));
                commentNewInputKeydownHandler(newPost.find('.comments-new-input'));
                commentNoInputClickHandler(newPost.find('.comments-new-noinput'));
                commentAddBtnClickHandler(newPost.find('.comment-addbtn'));
                commentCancelBtnClickHandler(newPost.find('.comment-cancelbtn'));
            }
        });

        $('#newBtn').click(function(){
            $('#postModal').postkit('show');
            return false;
        });
        $('#avatarModal').mouseleave(function(evt){
            $('#avatarModal').hide();
        });
        avatarHoverHandler($('#main-container').find('.avatar-icon'));
        postDelBtnClickHandler($('.post-delbtn'));
        postExpandBtnClickHandler($('.post-message-min'));
        commentsMoreClickHandler($('.comments-more'));
        commentNewInputKeydownHandler($('.comments-new-input'));
        commentNoInputClickHandler($('.comments-new-noinput'));
        commentAddBtnClickHandler($('.comment-addbtn'));
        commentCancelBtnClickHandler($('.comment-cancelbtn'));
        commentHoverHandler($('#post-list .comment'));
        commentDelBtnClickHandler($('#post-list .comment-delbtn'));
        commentReplyClickHandler($('#post-list .comment-reply'));

        initComet();

        function initComet(){
            var cometFrame = $('<iframe id="cometFrame"></iframe>');
            cometFrame.css('position','absolute');
            cometFrame.css('top','-100px');
            cometFrame.css('left','-100px');
            cometFrame.width(1);
            cometFrame.height(1);
            $('body').append(cometFrame);
            var url = "/streams/news?callback={cb}";
            var t = new Date().getTime();
            var content = '<body onload="var d=document,s=d.createElement(\'script\');s.src=\''
            +url.replace(/{cb}/,'parent.window.alert')
            +'\';d.getElementsByTagName(\'head\')[0].appendChild(s)"></body>';
            var doc = cometFrame[0].contentWindow.document;
            doc.open().write(content);
            doc.close();
        }
    </script>

}
